{"version":3,"file":"utils.js","sources":["uni_modules/uni-file-picker/components/uni-file-picker/utils.js"],"sourcesContent":["/**\r\n * 获取文件名和后缀\r\n * @param {String} name\r\n */\r\nexport const get_file_ext = (name) => {\r\n\tconst last_len = name.lastIndexOf('.')\r\n\tconst len = name.length\r\n\treturn {\r\n\t\tname: name.substring(0, last_len),\r\n\t\text: name.substring(last_len + 1, len)\r\n\t}\r\n}\r\n\r\n/**\r\n * 获取扩展名\r\n * @param {Array} fileExtname\r\n */\r\nexport const get_extname = (fileExtname) => {\r\n\tif (!Array.isArray(fileExtname)) {\r\n\t\tlet extname = fileExtname.replace(/(\\[|\\])/g, '')\r\n\t\treturn extname.split(',')\r\n\t} else {\r\n\t\treturn fileExtname\r\n\t}\r\n\treturn []\r\n}\r\n\r\n/**\r\n * 获取文件和检测是否可选\r\n */\r\nexport const get_files_and_is_max = (res, _extname) => {\r\n\tlet filePaths = []\r\n\tlet files = []\r\n\tif(!_extname || _extname.length === 0){\r\n\t\treturn {\r\n\t\t\tfilePaths,\r\n\t\t\tfiles\r\n\t\t}\r\n\t}\r\n\tres.tempFiles.forEach(v => {\r\n\t\tlet fileFullName = get_file_ext(v.name)\r\n\t\tconst extname = fileFullName.ext.toLowerCase()\r\n\t\tif (_extname.indexOf(extname) !== -1) {\r\n\t\t\tfiles.push(v)\r\n\t\t\tfilePaths.push(v.path)\r\n\t\t}\r\n\t})\r\n\tif (files.length !== res.tempFiles.length) {\r\n\t\tuni.showToast({\r\n\t\t\ttitle: `当前选择了${res.tempFiles.length}个文件 ，${res.tempFiles.length - files.length} 个文件格式不正确`,\r\n\t\t\ticon: 'none',\r\n\t\t\tduration: 5000\r\n\t\t})\r\n\t}\r\n\r\n\treturn {\r\n\t\tfilePaths,\r\n\t\tfiles\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 获取图片信息\r\n * @param {Object} filepath\r\n */\r\nexport const get_file_info = (filepath) => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tuni.getImageInfo({\r\n\t\t\tsrc: filepath,\r\n\t\t\tsuccess(res) {\r\n\t\t\t\tresolve(res)\r\n\t\t\t},\r\n\t\t\tfail(err) {\r\n\t\t\t\treject(err)\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n}\r\n/**\r\n * 获取封装数据\r\n */\r\nexport const get_file_data = async (files, type = 'image') => {\r\n\t// 最终需要上传数据库的数据\r\n\tlet fileFullName = get_file_ext(files.name)\r\n\tconst extname = fileFullName.ext.toLowerCase()\r\n\tlet filedata = {\r\n\t\tname: files.name,\r\n\t\tuuid: files.uuid,\r\n\t\textname: extname || '',\r\n\t\tcloudPath: files.cloudPath,\r\n\t\tfileType: files.fileType,\n\t\tthumbTempFilePath: files.thumbTempFilePath,\r\n\t\turl: files.path || files.path,\r\n\t\tsize: files.size, //单位是字节\r\n\t\timage: {},\r\n\t\tpath: files.path,\r\n\t\tvideo: {}\r\n\t}\r\n\tif (type === 'image') {\r\n\t\tconst imageinfo = await get_file_info(files.path)\r\n\t\tdelete filedata.video\r\n\t\tfiledata.image.width = imageinfo.width\r\n\t\tfiledata.image.height = imageinfo.height\r\n\t\tfiledata.image.location = imageinfo.path\r\n\t} else {\r\n\t\tdelete filedata.image\r\n\t}\r\n\treturn filedata\r\n}\r\n"],"names":["get_file_ext","name","last_len","len","get_extname","fileExtname","get_files_and_is_max","res","_extname","filePaths","files","v","extname","uni","get_file_info","filepath","resolve","reject","err","get_file_data","type","filedata","imageinfo"],"mappings":"6DAIaA,EAAgBC,GAAS,CACrC,MAAMC,EAAWD,EAAK,YAAY,GAAG,EAC/BE,EAAMF,EAAK,OACjB,MAAO,CACN,KAAMA,EAAK,UAAU,EAAGC,CAAQ,EAChC,IAAKD,EAAK,UAAUC,EAAW,EAAGC,CAAG,CACrC,CACF,EAMaC,EAAeC,GACtB,MAAM,QAAQA,CAAW,EAItBA,EAHOA,EAAY,QAAQ,WAAY,EAAE,EACjC,MAAM,GAAG,EAUbC,EAAuB,CAACC,EAAKC,IAAa,CACtD,IAAIC,EAAY,CAAE,EACdC,EAAQ,CAAE,EACd,MAAG,CAACF,GAAYA,EAAS,SAAW,EAC5B,CACN,UAAAC,EACA,MAAAC,CACA,GAEFH,EAAI,UAAU,QAAQI,GAAK,CAE1B,MAAMC,EADaZ,EAAaW,EAAE,IAAI,EACT,IAAI,YAAa,EAC1CH,EAAS,QAAQI,CAAO,IAAM,KACjCF,EAAM,KAAKC,CAAC,EACZF,EAAU,KAAKE,EAAE,IAAI,EAExB,CAAE,EACGD,EAAM,SAAWH,EAAI,UAAU,QAClCM,EAAAA,MAAI,UAAU,CACb,MAAO,QAAQN,EAAI,UAAU,MAAM,QAAQA,EAAI,UAAU,OAASG,EAAM,MAAM,YAC9E,KAAM,OACN,SAAU,GACb,CAAG,EAGK,CACN,UAAAD,EACA,MAAAC,CACA,EACF,EAOaI,EAAiBC,GACtB,IAAI,QAAQ,CAACC,EAASC,IAAW,CACvCJ,EAAAA,MAAI,aAAa,CAChB,IAAKE,EACL,QAAQR,EAAK,CACZS,EAAQT,CAAG,CACX,EACD,KAAKW,EAAK,CACTD,EAAOC,CAAG,CACV,CACJ,CAAG,CACH,CAAE,EAKWC,EAAgB,MAAOT,EAAOU,EAAO,UAAY,CAG7D,MAAMR,EADaZ,EAAaU,EAAM,IAAI,EACb,IAAI,YAAa,EAC9C,IAAIW,EAAW,CACd,KAAMX,EAAM,KACZ,KAAMA,EAAM,KACZ,QAASE,GAAW,GACpB,UAAWF,EAAM,UACjB,SAAUA,EAAM,SAChB,kBAAmBA,EAAM,kBACzB,IAAKA,EAAM,MAAQA,EAAM,KACzB,KAAMA,EAAM,KACZ,MAAO,CAAE,EACT,KAAMA,EAAM,KACZ,MAAO,CAAE,CACT,EACD,GAAIU,IAAS,QAAS,CACrB,MAAME,EAAY,MAAMR,EAAcJ,EAAM,IAAI,EAChD,OAAOW,EAAS,MAChBA,EAAS,MAAM,MAAQC,EAAU,MACjCD,EAAS,MAAM,OAASC,EAAU,OAClCD,EAAS,MAAM,SAAWC,EAAU,IACtC,MACE,OAAOD,EAAS,MAEjB,OAAOA,CACR"}