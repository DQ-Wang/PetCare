"use strict";const d=require("../../../../common/vendor.js"),g="chooseAndUploadFile:ok",p="chooseAndUploadFile:fail";function F(e){const{count:l,sizeType:o=["original","compressed"],sourceType:i,extension:r}=e;return new Promise((s,c)=>{d.index.chooseMedia({count:l,sizeType:o,sourceType:i,mediaType:["image"],extension:r,success(a){a.tempFiles.forEach(u=>{u.path=u.tempFilePath}),s(m(a,"image"))},fail(a){c({errMsg:a.errMsg.replace("chooseImage:fail",p)})}})})}function y(e){const{count:l,camera:o,compressed:i,maxDuration:r,sourceType:s,extension:c}=e;return new Promise((a,u)=>{d.index.chooseMedia({count:l,compressed:i,maxDuration:r,sourceType:s,extension:c,mediaType:["video"],success(t){const{tempFiles:h}=t;a(m({errMsg:"chooseVideo:ok",tempFiles:h.map(n=>({name:n.name||"",path:n.tempFilePath,thumbTempFilePath:n.thumbTempFilePath,size:n.size,type:t.tempFile&&t.tempFile.type||"",width:n.width,height:n.height,duration:n.duration,fileType:"video",cloudPath:""}))},"video"))},fail(t){u({errMsg:t.errMsg.replace("chooseVideo:fail",p)})}})})}function M(e){const{count:l,extension:o}=e;return new Promise((i,r)=>{let s=d.index.chooseFile;if(typeof d.wx$1<"u"&&typeof d.wx$1.chooseMessageFile=="function"&&(s=d.wx$1.chooseMessageFile),typeof s!="function")return r({errMsg:p+" 请指定 type 类型，该平台仅支持选择 image 或 video。"});s({type:"all",count:l,extension:o,success(c){i(m(c))},fail(c){r({errMsg:c.errMsg.replace("chooseFile:fail",p)})}})})}function m(e,l){return e.tempFiles.forEach((o,i)=>{o.name||(o.name=o.path.substring(o.path.lastIndexOf("/")+1)),l&&(o.fileType=l),o.cloudPath=Date.now()+"_"+i+o.name.substring(o.name.lastIndexOf("."))}),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map(o=>o.path)),e}function x(e,l=5,o){e=JSON.parse(JSON.stringify(e));const i=e.length;let r=0,s=this;return new Promise(c=>{for(;r<l;)a();function a(){let u=r++;if(u>=i){!e.find(n=>!n.url&&!n.errMsg)&&c(e);return}const t=e[u],h=s.files.findIndex(n=>n.uuid===t.uuid);t.url="",delete t.errMsg,d.nr.uploadFile({filePath:t.path,cloudPath:t.cloudPath,fileType:t.fileType,onUploadProgress:n=>{n.index=h,o&&o(n)}}).then(n=>{t.url=n.fileID,t.index=h,u<i&&a()}).catch(n=>{t.errMsg=n.errMsg||n.message,t.index=h,u<i&&a()})}})}function f(e,{onChooseFile:l,onUploadProgress:o}){return e.then(i=>{if(l){const r=l(i);if(typeof r<"u")return Promise.resolve(r).then(s=>typeof s>"u"?i:s)}return i}).then(i=>i===!1?{errMsg:g,tempFilePaths:[],tempFiles:[]}:i)}function P(e={type:"all"}){return e.type==="image"?f(F(e),e):e.type==="video"?f(y(e),e):f(M(e),e)}exports.chooseAndUploadFile=P;exports.uploadCloudFiles=x;
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/uni-file-picker/components/uni-file-picker/choose-and-upload-file.js.map
